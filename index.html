<html>

<head>
    <link href="dist/app.css" rel="stylesheet">
</head>

<body x-data="data()" x-init="initData">
    <div class="fixed overflow-hidden w-full h-full flex flex-col">
        <div x-ref="container" class="relative overflow-hidden w-full h-full z-10 flex items-center justify-center">
            <div
                class="absolute w-full h-full flex items-center justify-center transition-transform transform duration-1000 translate-x-full border-l border-gray-800 ">
                <div class="w-full h-full flex items-center justify-center text-6xl bg-blue-100">
                    Slideshow 1
                </div>
            </div>

            <div
                class="absolute w-full h-full flex items-center justify-center transition-transform transform duration-1000 translate-x-full border-l border-gray-800 ">
                <div class="w-full h-full flex items-center justify-center text-6xl bg-green-100">
                    Slideshow 2
                </div>
            </div>

            <div
                class="absolute w-full h-full flex items-center justify-center transition-transform transform duration-1000 translate-x-full border-l border-gray-800 ">
                <div class="w-full h-full flex items-center justify-center text-6xl bg-orange-100">
                    Slideshow 3
                </div>
            </div>

            <div
                class="absolute w-full h-full flex items-center justify-center transition-transform transform duration-1000 translate-x-full border-l border-gray-800 ">
                <div class="w-full h-full flex flex-col items-center justify-center text-6xl bg-purple-200">
                    <div>Slideshow 4</div>
                    <div>Has something different!</div>
                </div>
            </div>
        </div>

        <div x-show="!presentationMode" class="fixed w-full z-20 bottom-0 bg-white pt-1 border-t border-gray-800">
            <div class="px-2 min-h-32 w-full flex flex-shrink-0 items-center justify-start space-x-2 overflow-x-auto overflow-y-hidden whitespace-no-wrap"
                x-ref="previewContainer"></div>
            <div class="flex justify-center">
                <div class="mr-auto flex flex-col items-center">
                    <button @keydown.s.window="showShortcuts = !showShortcuts" @click="showShortcuts = !showShortcuts"
                        class=" px-4 font-bold hover:bg-blue-200"
                        x-text="(showShortcuts ? 'Hide' : 'Show') + ' Shortcuts'">Hide
                        Shortcuts</button>
                    <template x-if="showShortcuts">
                        <span class="text-gray-500">(s)</span>
                    </template>
                </div>

                <div class="flex flex-col items-center">
                    <button @keydown.home.window="goToFirstSlide()" @click="goToFirstSlide()"
                        class="px-4 font-bold hover:bg-blue-200">&lt;&lt;</button>
                    <template x-if="showShortcuts">
                        <span class="text-gray-500">(home)</span>
                    </template>
                </div>

                <div class="flex flex-col items-center">
                    <button @keydown.arrow-left.window="previousSlide()" @click="previousSlide()"
                        class="px-4 font-bold hover:bg-blue-200">&lt;</button>
                    <template x-if="showShortcuts">
                        <span class="text-gray-500">(&#8592;)</span>
                    </template>
                </div>

                <div class="px-4 text-xl font-medium">
                    <span class="pr-1" x-text="slideshowNumber"></span> of <span class="pl-1" x-text="total"></span>
                </div>

                <div class="flex flex-col items-center">
                    <button @keydown.arrow-right.window="nextSlide()" @click="nextSlide()"
                        class="px-4 font-bold hover:bg-blue-200">&gt;</button>
                    <template x-if="showShortcuts">
                        <span class="text-gray-500">(&#8594;)</span>
                    </template>
                </div>

                <div class="flex flex-col items-center">
                    <button @keydown.end.window="goToLastSlide()" @click="goToLastSlide()"
                        class="px-4 font-bold hover:bg-blue-200">&gt;&gt;</button>
                    <template x-if="showShortcuts">
                        <span class="text-gray-500">(end)</span>
                    </template>
                </div>

                <div class="ml-auto flex flex-col items-center">
                    <button @keydown.p.window="presentationMode = !presentationMode"
                        @click="presentationMode = !presentationMode"
                        class=" px-4 font-bold hover:bg-blue-200">Presentation Mode</button>
                    <template x-if="showShortcuts">
                        <span class="text-gray-500">(p)</span>
                    </template>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    function data() {
        return {
            slideshowNumber: 1,
            total: 0,
            slides: [],
            currentSlide: null,
            firstSlide: null,
            lastSlide: null,
            presentationMode: false,
            showShortcuts: true,

            initData() {
                for (i = 0; i < this.$refs.container.children.length; i++) {
                    var child = this.$refs.container.children[i]

                    if (child.tagName === "TEMPLATE") continue

                    this.total++

                    let index = i

                    if (this.$refs.container.firstElementChild.tagName !== "TEMPLATE") index = i + 1

                    if (index == this.slideshowNumber) {
                        child.classList.remove('translate-x-full')
                        this.currentSlide = child
                    }

                    this.slides.push(child)
                }

                this.firstSlide = this.currentSlide
                this.lastSlide = this.$refs.container.lastElementChild

                this.loadPreview()
            },

            loadPreview() {
                let previewContainer = this.$refs.previewContainer

                this.slides.forEach(function (slide, index) {
                    innerDiv = document.createElement("DIV")
                    innerDiv.innerHTML = slide.innerHTML

                    Array.from(innerDiv.children).forEach(function (child) {
                        child.removeAttribute('x-text')
                    })

                    innerDiv.style.width = slide.offsetWidth
                    innerDiv.style.height = slide.offsetHeight
                    innerDiv.classList.add('absolute', 'origin-top-left', 'border-8', 'border-gray-800')

                    previewDiv = document.createElement("DIV")
                    previewDiv.appendChild(innerDiv)
                    previewDiv.classList.add('relative', 'h-32', 'flex-shrink-0')

                    previewContainer.appendChild(previewDiv)


                    previewDiv.style.width = (slide.offsetWidth / slide.offsetHeight) * previewDiv.offsetHeight

                    scale = Math.min(previewDiv.offsetHeight / slide.offsetHeight, previewDiv.offsetWidth / slide.offsetWidth)

                    innerDiv.style.transform = 'scale(' + previewDiv.offsetWidth / slide.offsetWidth + ', ' + previewDiv.offsetHeight / slide.offsetHeight + ')'
                })
            },

            previousSlide() {
                previousSlide = this.currentSlide.previousElementSibling

                if (!previousSlide || typeof previousSlide === "undefined") return

                this.currentSlide.classList.add('translate-x-full')

                previousSlide.classList.remove('-translate-x-full')

                this.currentSlide = previousSlide
                this.slideshowNumber > 1 ? this.slideshowNumber-- : this.$refs.container.innerText = 'WHAT HAVE YOU DONE???'
            },

            nextSlide() {
                nextSlide = this.currentSlide.nextElementSibling

                if (!nextSlide || typeof nextSlide === "undefined") return

                this.currentSlide.classList.add('-translate-x-full')

                nextSlide.classList.remove('translate-x-full')

                this.currentSlide = nextSlide
                this.slideshowNumber++
            },

            goToFirstSlide() {
                if (this.slideshowNumber == 1) return

                this.slides.forEach(function (slide, index) {
                    if (index == 0) return

                    slide.classList.add('translate-x-full')
                    slide.classList.remove('-translate-x-full')
                })

                this.firstSlide.classList.remove('-translate-x-full')

                this.currentSlide = this.firstSlide
                this.slideshowNumber = 1
            },

            goToLastSlide() {
                if (this.slideshowNumber == this.total) return

                let self = this

                this.slides.forEach(function (slide, index) {
                    if (index == self.total - 1) return

                    slide.classList.add('-translate-x-full')
                    slide.classList.remove('translate-x-full')
                })

                this.lastSlide.classList.remove('translate-x-full')

                this.currentSlide = this.lastSlide
                this.slideshowNumber = this.total
            }
        }
    }
</script>
<script src="dist/app.js"></script>

</html>